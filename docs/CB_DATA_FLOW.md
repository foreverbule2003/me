# CB çˆ¬èŸ²è³‡æ–™æµæ¶æ§‹ (CB Crawler Data Flow Architecture)

> **æœ€å¾Œæ›´æ–°æ—¥æœŸ**: 2026-01-27
> **ç‹€æ…‹**: Production Ready (å·²ä¸Šç·š)

æœ¬æ–‡ä»¶è©³ç´°è¨˜éŒ„äº†ã€Œå¯è½‰å‚µ (CB) æˆ°æƒ…å®¤ã€èˆ‡ã€Œè¨ˆç®—æ©Ÿã€èƒŒå¾Œçš„è‡ªå‹•åŒ–è³‡æ–™æµæ¶æ§‹ã€‚æ­¤ç³»çµ±æ¡ç”¨ **é›™è»Œä¸¦è¡Œ (Dual Track)** ç­–ç•¥ï¼Œç¢ºä¿ç†±é–€æ•¸æ“šçš„å³æ™‚æ€§ï¼ŒåŒæ™‚ç¶­æŒå…¨å¸‚å ´æœç´¢çš„å®Œæ•´æ€§ã€‚

## æ ¸å¿ƒç­–ç•¥ï¼šé›™è»Œåˆ†æµ (Dual Track Strategy)

ç‚ºäº†è§£æ±ºå–®ä¸€æª”æ¡ˆç„¡æ³•åŒæ™‚æ»¿è¶³ã€Œç²¾ç°¡ç†±é–€æ’è¡Œã€èˆ‡ã€Œå®Œæ•´å¸‚å ´æœå°‹ã€çš„çŸ›ç›¾ï¼Œæˆ‘å€‘å°‡è³‡æ–™æµæ‹†åˆ†ç‚ºå…©æ¢ç¨ç«‹è·¯å¾‘ï¼š

### 1. è·¯å¾‘ Aï¼šæˆ°æƒ…å®¤ç†±é–€æ¸…å–® (Hot List) ğŸï¸

- **ç›®æ¨™æª”æ¡ˆ**: `public/data/hot-cb.json`
- **å…§å®¹**: åš´æ ¼ç¯©é¸çš„ **Top 20** æˆäº¤é‡ç†±é–€å¯è½‰å‚µã€‚
- **è³‡æ–™ç‰¹æ€§**:
  - **è¼•é‡**: æª”æ¡ˆæ¥µå°ï¼Œå‰ç«¯è¼‰å…¥ç„¡è² æ“”ã€‚
  - **å³æ™‚**: åƒ…åŒ…å«ç•¶æ—¥æœ‰äº¤æ˜“ä¸”æˆåŠŸæŠ“å–åˆ°åƒ¹æ ¼çš„æ¨™çš„ï¼Œä¿è­‰ç„¡ `NaN`ã€‚
- **ç”¨é€”**: å°ˆä¾› `cb-war-room.html` (æˆ°æƒ…å®¤) é¡¯ç¤ºã€‚

### 2. è·¯å¾‘ Bï¼šå…¨å¸‚å ´æœå°‹ç›®éŒ„ (Master Directory) ğŸ“–

- **ç›®æ¨™æª”æ¡ˆ**: `public/data/cb-data.json`
- **å…§å®¹**: å¸‚å ´ä¸Š **300+ æª”** æ‰€æœ‰å¯è½‰å‚µçš„ç¸½é›†ã€‚
- **è³‡æ–™ç‰¹æ€§**:
  - **å®Œæ•´**: åŒ…å«æ‰€æœ‰å·²çŸ¥çš„å¯è½‰å‚µä»£è™Ÿèˆ‡åç¨±ã€‚
  - **æ··åˆæ›´æ–°**: è‹¥ç•¶æ—¥æœ‰æŠ“åˆ°æ–°åƒ¹æ ¼å‰‡æ›´æ–°ï¼Œè‹¥ç„¡å‰‡ä¿ç•™èˆŠè³‡æ–™ã€‚
- **ç”¨é€”**: ä¾› `cb-calculator.html` (è¨ˆç®—æ©Ÿ) çš„æœå°‹æ¡† (Autocomplete) ä½¿ç”¨ï¼Œç¢ºä¿ä½¿ç”¨è€…èƒ½æŸ¥åˆ°ä»»ä½•ä¸€æª”æ¨™çš„ã€‚

## è‡ªå‹•åŒ–å¾ªç’° (The Automation Loop)

ç³»çµ±ä¾è³´ GitHub Actions é€²è¡Œæ¯æ—¥çš„å…¨è‡ªå‹•ç¶­è­·ï¼Œå®Œå…¨ç„¡éœ€äººå·¥ä»‹å…¥ã€‚

### ğŸ“… æ’ç¨‹ (Schedule)

- **æ¯æ—¥ 09:00 (UTC+8)**: é–‹ç›¤å‰æª¢æŸ¥ã€‚
- **æ¯æ—¥ 13:30 (UTC+8)**: æ”¶ç›¤å¾Œæ›´æ–° (ä¸»è¦è³‡æ–™ç”¢å‡ºé»)ã€‚

### ğŸ”„ åŸ·è¡Œæµç¨‹

1.  **è§¸ç™¼ (Trigger)**: GitHub Action å•Ÿå‹• `daily-hot-cb.yml` å·¥ä½œæµç¨‹ã€‚
2.  **åŸ·è¡Œ (Execute)**: é‹è¡Œ `tools/fetch-hot-cb.js` è…³æœ¬ã€‚
3.  **åˆ†æµ (Split)**: è…³æœ¬å…§éƒ¨åˆ†åˆ¥ç”¢å‡º `hot-cb.json` èˆ‡ `cb-data.json`ã€‚
4.  **æäº¤ (Commit)**: Action è‡ªå‹•åµæ¸¬æª”æ¡ˆè®Šæ›´ï¼Œä¸¦ Commit å› Repositoryã€‚
5.  **éƒ¨ç½² (Deploy)**: GitHub Pages è‡ªå‹•é‡æ–°éƒ¨ç½²ï¼Œå‰ç«¯ä½¿ç”¨è€…å³å¯è®€å–åˆ°æœ€æ–° JSONã€‚

## æ¶æ§‹è¦–è¦ºåŒ– (Architecture Diagram)

```mermaid
graph TD
    %% ä¾†æºèˆ‡è§¸ç™¼
    Cron[GitHub Action æ¯æ—¥æ’ç¨‹] -->|09:00, 13:30| Script[tools/fetch-hot-cb.js]
    Market[å¤–éƒ¨å¸‚å ´æ•¸æ“š] -->|çˆ¬å–| Script

    %% æ ¸å¿ƒåˆ†æµè™•ç†
    subgraph Data_Processing [æ ¸å¿ƒè™•ç†å¼•æ“]
        Script -->|åˆ†é›¢é‚è¼¯| PathA[è·¯å¾‘ A: æˆ°æƒ…å®¤å°ˆç”¨]
        Script -->|åˆ†é›¢é‚è¼¯| PathB[è·¯å¾‘ B: è¨ˆç®—æ©Ÿæœå°‹]
        Script -->|å‚™ä»½| PathC[è·¯å¾‘ C: é›²ç«¯æ­·å²]
    end

    %% å„²å­˜å±¤
    PathA -->|å¯«å…¥| HotFile[public/data/hot-cb.json]
    PathB -->|å¯«å…¥ æ›´æ–°| MasterFile[public/data/cb-data.json]
    PathC -->|å­˜æª”| Firestore[(Firebase Cloud)]

    %% éƒ¨ç½²
    HotFile -->|Commit and Push| GitHubPages[GitHub Pages CDN]
    MasterFile -->|Commit and Push| GitHubPages

    %% ä½¿ç”¨è€…ç«¯ (ç€è¦½å™¨)
    subgraph Client_Side [ä½¿ç”¨è€…ç€è¦½å™¨]
        WarRoom[CB æˆ°æƒ…å®¤] -->|fetch| HotFile
        Calculator[CB è¨ˆç®—æ©Ÿ] -->|fetch| MasterFile
        HistoryService[æ­·å²èµ°å‹¢åœ–] -->|Smart Sync| Firestore
    end

    %% é—œè¯èˆ‡ç”¨é€”
    note1[å…§å®¹: åš´æ ¼å‰ 20 å<br>ç”¨é€”: é¡¯ç¤ºæœ¬æ—¥ç†±é–€æ’è¡Œ] -.- HotFile
    note2[å…§å®¹: æ‰€æœ‰ 300+ æª”å¯è½‰å‚µ<br>ç”¨é€”: æœå°‹è‡ªå‹•å®Œæˆ] -.- MasterFile
```

## æª”æ¡ˆçµæ§‹èªªæ˜

```text
/public/data/
â”œâ”€â”€ hot-cb.json       # [New] æ¯æ—¥ Top 20 ç†±é–€è‚¡ (ç„¡é›œè³ª)
â”œâ”€â”€ cb-data.json      # [Master] å…¨å¸‚å ´é€šè¨ŠéŒ„
â””â”€â”€ history/          # [Deprecated] èˆŠç‰ˆæ­·å²è³‡æ–™å¤¾ (å·²æ¸…ç©º)
```
