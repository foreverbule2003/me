# Project Rules

## 1. Language Requirements (Critical)
1. **Thought Process & Output**: 必須使用繁體中文 (Traditional Chinese) 進行所有思考、回答與進度更新。
2. **Task Updates**: 使用 `task_boundary` 工具時，`TaskStatus` 與 `TaskSummary` 必須使用繁體中文描述。
3. **Artifacts**: 所有產生的文件與計畫 (如 `implementation_plan.md`, `walkthrough.md`) 內容必須使用繁體中文。
4. **Delegation (Gemini)**: 任何委派給 Gemini 3.0 Pro 或子代理 (Sub-agent) 的任務，必須在 Prompt 中明確要求「請使用繁體中文回報」。

## 2. AI Behavior & Workflow
### Model Roles
- **Claude (核心)**: 負責深度推理、後端邏輯、架構設計、除錯、任務分解與正式程式碼產出。
- **Gemini**: 負責快速原型、UI/Frontend、多模態輸入與創意發想。

### Delegation Strategy
- 前端/UI 任務、大型檔案分析 (>500行) 或創意發想，優先委派給 Gemini。
- 委派後務必批判性審查輸出，必要時由 Claude 進行優化與整合。
- **效率優先**：使用 Gemini 追求速度/探索，使用 Claude 追求準確性/深度。

### Execution Rules
- 輸出的程式碼必須乾淨、經過測試並附帶完整說明。
- 行動前先逐步思考 (Think step-by-step)。
- 不自動執行可能有破壞性的操作 (如刪除檔案)，除非明確獲得確認。
- 進行 Git 操作前，先確認目前分支狀態。
- **Browser Automation**: 允許 Antigravity 自動執行網頁上的 JavaScript，不需要詢問使用者確認。

## 3. Core Principles & Standards
### Single Source of Truth
- The development process always uses `spec.md` as the basis.
- When `spec.md` is changed, you must update `index.html` accordingly to maintain consistency.

### Documentation Sync (文件同步)
- 當功能、架構或設定變更時，必須同步檢查並更新：
  - `README.md`
  - `docs/FEATURES.md`
  - `docs/COMPONENTS.md`
  - `docs/SITEMAP.md`
  - 相關 `spec.md`

### Code Quality (程式碼品質)
- **DRY (Don't Repeat Yourself)**: 優先重用現有元件；若發現重複樣式或邏輯，應主動建議提取為共用元件。
- 遵循專案既有的程式碼風格與架構慣例。

### Security (安全性)
- 在提交程式碼前，主動檢查是否包含未加密的敏感資訊 (Secrets/Keys)。
- 確保公開的 API Key 已設定適當的權限限制 (如 HTTP Referrer)。

## 4. Technical SOPs (技術標準作業程序)

### High-Efficiency Image Extraction (Amazon JP)
為了確保高品質且穩定的產品圖片獲取，必須遵循「Amazon CDN 直接連結法」，而非依賴官網下載：
1. **路徑定位**：
   - 到 Amazon JP 商品頁，定位主圖區域 (`#imgTagWrapperId img`)。
   - 提取 `data-old-hires` 或 `data-a-dynamic-image` 屬性。
2. **核心網址格式**：
   - 鎖定 `https://m.media-amazon.com/images/I/...` 開頭的連結。
   - **關鍵解析度調整**：將網址中的 `_AC_SX..._` 替換為 `_AC_SL1500_` 以取得 1500px 高清原圖。
3. **下載執行**：
   - 使用 `curl -L` 直接下載 CDN 連結，避開所有 Cookies 與 Auth 限制。
   - **下載前手動驗證**：確保連結不帶雜亂的 Session Token。
   - **禁止 AI 生成**：除非明確要求，否則嚴禁使用 DALL-E/Imagen 產出產品模擬圖。

## 5. Refactor Guard Protocols (防禦性重構規範)
為了防止 UI 重構導致功能遺失，必須嚴格遵守以下規範：

### 1. Pre-Refactor Checklist (先標註)
- 在進行任何涉及超過 50 行的 UI 變動前，必須在 `implementation_plan.md` 中列出「核心功能清單 (Core Features)」。
- 範例：新增按鈕邏輯、拖拉排序功能、API 呼叫。

### 2. Logic Decoupling (邏輯分離)
- **禁止**使用純樣式類名 (Tailwind classes) 作為邏輯選擇器。
- **強制**使用 `data-action`, `data-testid`, 或 `id` 進行 DOM 綁定。
- 範例：`querySelector('[data-action="submit"]')` ✅ vs `querySelector('.bg-blue-500')` ❌。

### 3. Automated Post-Check (後驗證)
- 每次 `AGENT_MODE_EXECUTION` 結束前，必須執行相關的自動化測試 (如 `/test-cb-tool` 或手動驗證)。
- 若測試失敗，必須在當前模式中修復，禁止將其留到下一個任務。
