<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2026 hokkaido</title>
    <!-- 1. Google Fonts (Inter + DM Sans) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Inter:wght@400;700;800;900&family=DM+Sans:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- 2. å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#0F2540", // Shimakaze Deep Blue
              accent: "#C5A059", // Champagne Gold
              dark: "#1C1C1E", // Elegant Black
              subtle: "#6E6E73", // Apple-like Grey
              surface: "#F5F5F0", // Washi Paper White
              star: "#D4AF37", // Gold
              love: "#C32F2F", // Deep Red
            },
            borderRadius: {
              "3xl": "24px",
              "4xl": "32px",
            },
            fontFamily: {
              display: ['"Noto Serif JP"', "serif"],
              body: ['"DM Sans"', "sans-serif"],
            },
          },
        },
      };
    </script>
    <!-- 3. å¼•å…¥ React å’Œ ReactDOM -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <!-- 4. å¼•å…¥ Babel ç”¨ä¾†è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 5. å¼•å…¥ Iconify (æ”¯æ´å¤šå¥— icon åŒ…æ‹¬ Lucide) -->
    <script src="https://cdn.jsdelivr.net/npm/@iconify/react@4/dist/iconify.min.js"></script>

    <style>
      /* Modern Minimalist Animations */
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(24px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }

        50% {
          transform: translateY(-8px);
        }
      }

      .animate-fade-up {
        animation: fadeUp 0.6s ease-out forwards;
      }

      .animate-fade-up-delay-1 {
        animation-delay: 0.1s;
        opacity: 0;
      }

      .animate-fade-up-delay-2 {
        animation-delay: 0.2s;
        opacity: 0;
      }

      .animate-fade-up-delay-3 {
        animation-delay: 0.3s;
        opacity: 0;
      }

      .anim-float {
        animation: float 3s ease-in-out infinite;
      }

      /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }

      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      /* Glass Effect */
      .glass {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }
    </style>
  </head>

  <body
    class="bg-surface font-body text-dark selection:bg-accent/20 selection:text-primary"
  >
    <div id="root"></div>

    <script type="text/babel">
      // --- 0. åˆå§‹åŒ–èˆ‡åœ–ç¤ºè™•ç† (Icons Handler) ---
      const { useState, useEffect, useRef } = React;

      // å»ºç«‹çµ±ä¸€çš„ Icon Wrapper - ä½¿ç”¨å…§åµŒ SVG
      const LucideIcon = ({ name, size = 24, className, ...props }) => {
        // SVG å…±ç”¨å±¬æ€§
        const svgProps = {
          width: size,
          height: size,
          viewBox: "0 0 24 24",
          fill: "none",
          stroke: "currentColor",
          strokeWidth: 2,
          strokeLinecap: "round",
          strokeLinejoin: "round",
          className,
          ...props,
        };

        // æ‰€æœ‰ Lucide åœ–ç¤ºçš„ SVG path
        const iconPaths = {
          "map-pin": (
            <>
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
              <circle cx="12" cy="10" r="3" />
            </>
          ),
          car: (
            <>
              <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.5 2.8C1.4 11.3 1 12.1 1 13v3c0 .6.4 1 1 1h2" />
              <circle cx="7" cy="17" r="2" />
              <circle cx="17" cy="17" r="2" />
            </>
          ),
          map: (
            <>
              <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" />
              <line x1="8" y1="2" x2="8" y2="18" />
              <line x1="16" y1="6" x2="16" y2="22" />
            </>
          ),
          calendar: (
            <>
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
              <line x1="16" y1="2" x2="16" y2="6" />
              <line x1="8" y1="2" x2="8" y2="6" />
              <line x1="3" y1="10" x2="21" y2="10" />
            </>
          ),
          wallet: (
            <>
              <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4" />
              <path d="M3 5v14a2 2 0 0 0 2 2h16v-5" />
              <path d="M18 12a2 2 0 0 0 0 4h4v-4Z" />
            </>
          ),
          navigation: <polygon points="3 11 22 2 13 21 11 13 3 11" />,
          train: (
            <>
              <rect x="4" y="3" width="16" height="16" rx="2" />
              <path d="M4 11h16" />
              <path d="M12 3v8" />
              <path d="m8 19-2 3" />
              <path d="m18 22-2-3" />
              <path d="M8 15h.01" />
              <path d="M16 15h.01" />
            </>
          ),
          utensils: (
            <>
              <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" />
              <path d="M7 2v20" />
              <path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3m0 0v7" />
            </>
          ),
          hotel: (
            <>
              <path d="M18 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z" />
              <path d="m9 16 .348-.24c1.465-1.013 3.84-1.013 5.304 0L15 16" />
              <path d="M8 7h.01" />
              <path d="M16 7h.01" />
              <path d="M12 7h.01" />
              <path d="M12 11h.01" />
              <path d="M16 11h.01" />
              <path d="M8 11h.01" />
              <path d="M10 22v-6.5m4 0V22" />
            </>
          ),
          "arrow-right": (
            <>
              <path d="M5 12h14" />
              <path d="m12 5 7 7-7 7" />
            </>
          ),
          leaf: (
            <>
              <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z" />
              <path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12" />
            </>
          ),
          star: (
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
          ),
          info: (
            <>
              <circle cx="12" cy="12" r="10" />
              <path d="M12 16v-4" />
              <path d="M12 8h.01" />
            </>
          ),
          sparkles: (
            <>
              <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
              <path d="M5 3v4" />
              <path d="M19 17v4" />
              <path d="M3 5h4" />
              <path d="M17 19h4" />
            </>
          ),
          x: (
            <>
              <path d="M18 6 6 18" />
              <path d="m6 6 12 12" />
            </>
          ),
          send: (
            <>
              <path d="m22 2-7 20-4-9-9-4Z" />
              <path d="M22 2 11 13" />
            </>
          ),
          "external-link": (
            <>
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
              <polyline points="15 3 21 3 21 9" />
              <line x1="10" y1="14" x2="21" y2="3" />
            </>
          ),
          bot: (
            <>
              <path d="M12 8V4H8" />
              <rect width="16" height="12" x="4" y="8" rx="2" />
              <path d="M2 14h2" />
              <path d="M20 14h2" />
              <path d="M15 13v2" />
              <path d="M9 13v2" />
            </>
          ),
          "message-circle": <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" />,
          languages: (
            <>
              <path d="m5 8 6 6" />
              <path d="m4 14 6-6 2-3" />
              <path d="M2 5h12" />
              <path d="M7 2h1" />
              <path d="m22 22-5-10-5 10" />
              <path d="M14 18h6" />
            </>
          ),
          route: (
            <>
              <circle cx="6" cy="19" r="3" />
              <path d="M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15" />
              <circle cx="18" cy="5" r="3" />
            </>
          ),
          eye: (
            <>
              <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
              <circle cx="12" cy="12" r="3" />
            </>
          ),
          bus: (
            <>
              <path d="M8 6v6" />
              <path d="M15 6v6" />
              <path d="M2 12h19.6" />
              <path d="M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3" />
              <circle cx="7" cy="18" r="2" />
              <path d="M9 18h5" />
              <circle cx="16" cy="18" r="2" />
            </>
          ),
          ship: (
            <>
              <path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1" />
              <path d="M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.94 5.34 2.81 7.76" />
              <path d="M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6" />
              <path d="M12 10v4" />
              <path d="M12 2v3" />
            </>
          ),
        };

        const pathContent = iconPaths[name];
        if (pathContent) {
          return <svg {...svgProps}>{pathContent}</svg>;
        }

        // Final fallback
        return (
          <svg {...svgProps}>
            <circle cx="12" cy="12" r="10" />
          </svg>
        );
      };

      // å®šç¾© App ä½¿ç”¨åˆ°çš„åœ–ç¤ºèˆ‡å…¶å°æ‡‰çš„ Lucide åç¨± (kebab-case)
      const iconNames = {
        MapIcon: "map",
        Calendar: "calendar",
        Wallet: "wallet",
        Train: "train",
        Utensils: "utensils",
        Hotel: "hotel",
        ArrowRight: "arrow-right",
        Leaf: "leaf",
        Star: "star",
        Info: "info",
        Sparkles: "sparkles",
        X: "x",
        Send: "send",
        MapPin: "map-pin",
        Navigation: "navigation",
        ExternalLink: "external-link",
        Bot: "bot",
        MessageCircle: "message-circle",
        Languages: "languages",
        RouteIcon: "route",
        Eye: "eye",
        Car: "car",
        Bus: "bus",
        Ship: "ship",
      };

      // å‹•æ…‹ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„åœ–ç¤ºå…ƒä»¶
      const Icons = Object.fromEntries(
        Object.entries(iconNames).map(([componentName, iconName]) => [
          componentName,
          (props) => <LucideIcon name={iconName} {...props} />,
        ]),
      );

      // è§£æ§‹å‡ºæ‰€æœ‰åœ–ç¤ºä¾›ä¸‹æ–¹ä½¿ç”¨
      const {
        MapIcon,
        Calendar,
        Wallet,
        Train,
        Utensils,
        Hotel,
        ArrowRight,
        Leaf,
        Star,
        Info,
        Sparkles,
        X,
        Send,
        MapPin,
        Navigation,
        ExternalLink,
        Bot,
        MessageCircle,
        Languages,
        RouteIcon,
        Eye,
        Car,
        Bus,
        Ship,
      } = Icons;

      // --- 1. è³‡æ–™å¸¸æ•¸ (Data Constants) ---

      const strategyData = {
        title: "åŒ—æµ·é“æ¢ç´¢ä¹‹æ—… (2026)",
        content: "2026å¹´åŒ—æµ·é“ä¹‹æ—…æ­£åœ¨è¦åŠƒä¸­ã€‚æ•¬è«‹æœŸå¾…ï¼",
        transport: ["TBD"],
        accommodation: ["TBD"],
      };

      const itineraryData = [
        {
          phase: "ç¬¬ä¸€éšæ®µï¼šè¦åŠƒä¸­",
          days: [
            {
              day: 1,
              title: "æŠµé”åŒ—æµ·é“",
              image: "https://images.unsplash.com/photo-1548181657-68b37e06dd87?q=80&w=2070&auto=format&fit=crop",
              time: "TBD",
              activities: [
                {
                  time: "TBD",
                  text: "è¡Œç¨‹è¦åŠƒä¸­...",
                },
              ],
              highlight: "æœŸå¾…æ‚¨çš„å†’éšªï¼",
            },
          ],
        },
      ];

      const budgetData = [
        {
          item: "é ä¼°",
          cost: 0,
          note: "TBD",
        },
      ];

      const recommendedRoutes = [];

      const mapLocations = {
        regions: [],
      };

      // --- 2. è¼”åŠ©å‡½æ•¸ (Helper Functions) ---

      const cleanQuery = (text) => {
        let cleaned = text.replace(
          /[\u{1F600}-\u{1F6FF}|[\u{1F300}-\u{1F5FF}|[\u{1F680}-\u{1F6FF}|[\u{1F700}-\u{1F77F}|[\u{1F780}-\u{1F7FF}|[\u{1F800}-\u{1F8FF}|[\u{1F900}-\u{1F9FF}|[\u{1FA00}-\u{1FA6F}|[\u{1FA70}-\u{1FAFF}]/gu,
          "",
        );
        cleaned = cleaned.replace(
          /æ­ä¹˜|ç§»å‹•|å‰å¾€|æŠµé”|å…¥ä½|æ™šé¤|åˆé¤|åƒæ‹œ/g,
          "",
        );
        cleaned = cleaned.replace(/[ï¼š:()ï¼ˆï¼‰]/g, " ");
        return cleaned.trim();
      };

      const callGeminiAPI = async (prompt, systemContext = "") => {
        const apiKey = ""; // åœ¨æ­¤å¡«å…¥æ‚¨çš„ API Key (å¦‚æœæœ‰)
        const model = "gemini-3.0-pro";

        const fullSystemInstruction = `
                You are a helpful, expert travel concierge for a vegetarian trip to Japan (Ise-Shima and Osaka).
                Current Itinerary Context: ${JSON.stringify(itineraryData)}
                User Style Guide & Strategy: ${JSON.stringify(strategyData)}
                Your persona: Friendly, polite, knowledgeable about vegetarian dining.
                Respond in Traditional Chinese (ç¹é«”ä¸­æ–‡).
                Specific Instruction: ${systemContext}
            `;

        try {
          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: fullSystemInstruction }] },
              }),
            },
          );
          const data = await response.json();
          if (data.error) {
            console.error("Gemini Error:", data.error);
            return "æŠ±æ­‰ï¼ŒAI æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
          }
          return (
            data.candidates?.[0]?.content?.parts?.[0]?.text ||
            "æŠ±æ­‰ï¼ŒAI ç›®å‰å¿™ç¢Œä¸­ã€‚"
          );
        } catch (error) {
          console.error("Fetch Error:", error);
          return "é€£ç·šç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹ã€‚";
        }
      };

      // --- 3. UI å…ƒä»¶ (Components) ---

      // 3.1 Header (Luxury Visual Update)
      const Header = () => (
        <header className="relative w-full py-32 px-6 text-white overflow-hidden">
          {/* Background Image & Overlay */}
          <div className="absolute inset-0 z-0 select-none">
            <img
              src="./images/hero.png"
              alt="Hokkaido Winter"
              className="w-full h-full object-cover opacity-90 scale-105 animate-[float_20s_ease-in-out_infinite]"
            />
            <div className="absolute inset-0 bg-gradient-to-b from-primary/90 via-primary/60 to-surface/100"></div>
            <div className="absolute inset-0 bg-primary/40 mix-blend-overlay"></div>
          </div>

          <div className="max-w-5xl mx-auto text-center relative z-10">
            <div className="inline-block px-5 py-2 mb-6 rounded-full bg-primary/30 backdrop-blur-md text-sm font-bold tracking-wider border border-accent/40 text-accent/90 animate-fade-up shadow-lg">
              JP-HOKKAIDO-2026-WINTER
            </div>
            <h1 className="font-display text-5xl md:text-7xl font-black mb-6 leading-tight tracking-tight animate-fade-up animate-fade-up-delay-1 drop-shadow-xl text-yellow-50">
              åŒ—æµ·é“æ¢ç´¢
              <span className="block text-2xl md:text-4xl mt-4 font-light tracking-[0.2em] font-body opacity-90">
                é›ªåœ‹ç§˜å¢ƒä¹‹æ—…
              </span>
            </h1>
            <p className="text-lg md:text-xl text-white/90 max-w-xl mx-auto animate-fade-up animate-fade-up-delay-2 font-medium drop-shadow-md">
              {strategyData.content}
            </p>
          </div>
        </header>
      );

      // 3.2 SectionCard
      const SectionCard = ({ icon: Icon, title, children, className = "" }) => (
        <section
          className={`bg-white rounded-3xl p-6 md:p-8 shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 ${className}`}
        >
          <div className="flex items-center gap-3 mb-6 border-b border-gray-100 pb-4">
            <div className="p-3 bg-accent/10 rounded-xl text-accent">
              <Icon size={24} />
            </div>
            <h2 className="text-2xl font-bold text-gray-800">{title}</h2>
          </div>
          {children}
        </section>
      );

      // 3.3 StrategySection
      const StrategySection = () => (
        <div className="grid md:grid-cols-2 gap-6 mb-8">
          <SectionCard icon={Star} title="æ ¸å¿ƒç­–ç•¥">
            <p className="text-gray-600 text-lg leading-relaxed mb-4">
              {strategyData.content}
            </p>
            <div className="flex flex-wrap gap-2">
              <span className="text-white px-4 py-1.5 rounded-full text-sm font-medium bg-accent/90">
                åå¤å±‹é€²
              </span>
              <span className="text-white px-4 py-1.5 rounded-full text-sm font-medium bg-accent/90">
                é ç®—å‡ç´š
              </span>
              <span className="text-white px-4 py-1.5 rounded-full text-sm font-medium bg-accent/90">
                ç´ é£Ÿå‹å–„
              </span>
              <span className="text-white px-4 py-1.5 rounded-full text-sm font-medium bg-accent/90">
                å¤§çœ¾é‹è¼¸
              </span>
            </div>
          </SectionCard>

          <SectionCard icon={Train} title="äº¤é€šèˆ‡ä½å®¿">
            <div className="space-y-4">
              <div>
                <h3 className="font-bold text-gray-800 flex items-center gap-2 mb-2">
                  <Train size={18} className="text-accent" /> å¥¢è¯ç§»å‹•
                </h3>
                <ul className="list-disc list-inside text-gray-600 pl-2 space-y-1">
                  {strategyData.transport.map((item, idx) => (
                    <li key={idx}>{item}</li>
                  ))}
                </ul>
              </div>
              <div>
                <h3 className="font-bold text-gray-800 flex items-center gap-2 mb-2">
                  <Hotel size={18} className="text-accent" /> ä½å®¿å»ºè­°
                </h3>
                <ul className="list-disc list-inside text-gray-600 pl-2 space-y-1">
                  {strategyData.accommodation.map((item, idx) => (
                    <li key={idx}>{item}</li>
                  ))}
                </ul>
              </div>
            </div>
          </SectionCard>
        </div>
      );

      // 3.4 DayCard (Refined: Smart Fallback Logic Added)
      const DayCard = ({ dayData, onOpenRoute }) => (
        <div className="relative bg-white rounded-3xl shadow-md border border-gray-100 hover:shadow-lg transition-all duration-300 mb-6 flex flex-col h-full overflow-hidden group">
          {/* Image Banner */}
          <div className="h-48 w-full relative overflow-hidden">
            <img
              src={dayData.image}
              alt={dayData.title}
              className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-dark/80 to-transparent"></div>
            <div className="absolute bottom-4 left-6 text-white">
              <div className="text-sm font-bold opacity-90 mb-1 tracking-wider uppercase text-accent">
                {dayData.time}
              </div>
              <h3 className="text-2xl font-bold font-display leading-tight">
                {dayData.title}
              </h3>
            </div>
            <div className="absolute top-4 right-4">
              <span className="flex items-center justify-center w-12 h-12 rounded-xl bg-white/10 backdrop-blur-md text-white font-bold text-lg border border-white/20 shadow-lg">
                {typeof dayData.day === "number"
                  ? `D${dayData.day}`
                  : dayData.day}
              </span>
            </div>
          </div>

          <div className="p-6 flex-1 flex flex-col">
            <div className="space-y-4 mb-6 flex-1">
              {dayData.activities.map((act, idx) => {
                // Check for explicit map data OR arrow for fallback route detection
                const hasExplicitMap = !!act.map;
                const hasArrow = act.text.includes("â†’");
                const isRoute = hasExplicitMap
                  ? act.map.type === "route"
                  : hasArrow;

                return (
                  <div key={idx} className="flex items-start gap-3">
                    <span className="text-xs font-bold text-indigo-400 min-w-[3rem] pt-1">
                      {act.time}
                    </span>
                    <span className="flex-1 text-gray-600 text-sm leading-relaxed pr-8">
                      {act.text}
                      {act.link && (
                        <a
                          href={act.link}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="ml-1 text-indigo-500 hover:text-indigo-700 underline"
                        >
                          æŸ¥æ™‚åˆ»è¡¨ â†—
                        </a>
                      )}
                    </span>

                    {(hasExplicitMap || hasArrow) && (
                      <button
                        onClick={() => {
                          if (hasExplicitMap) {
                            onOpenRoute({
                              type: act.map.type || "spot",
                              name: cleanQuery(act.text),
                              ...act.map,
                            });
                          } else if (hasArrow) {
                            const parts = act.text.split("â†’");
                            const origin = cleanQuery(parts[0]);
                            const destination = cleanQuery(
                              parts[parts.length - 1],
                            );
                            onOpenRoute({
                              type: "route",
                              name: cleanQuery(act.text),
                              origin: origin,
                              destination: destination,
                            });
                          }
                        }}
                        className={`
                          flex-shrink-0 hover:scale-110 transition-transform cursor-pointer
                          ${isRoute ? "text-accent" : "text-subtle hover:text-accent"}
                        `}
                        title={isRoute ? "æŸ¥çœ‹äº¤é€šè·¯ç·š" : "æŸ¥çœ‹åœ°é»"}
                      >
                        {isRoute ? <Train size={18} /> : <MapPin size={18} />}
                      </button>
                    )}
                  </div>
                );
              })}
            </div>

            <div className="mt-auto pt-6">
              <div className="border-l-4 border-accent p-4 bg-accent/5 rounded-r-xl hover:bg-accent/10 transition-colors">
                <div className="text-sm font-semibold text-accent mb-1 flex items-center gap-1">
                  <Leaf size={14} /> ç´ é£Ÿ / äº®é»
                </div>
                <div className="text-gray-700 font-medium leading-relaxed">
                  {dayData.highlight}
                </div>
              </div>
            </div>
          </div>
        </div>
      );

      // 3.5 BudgetTable
      const BudgetTable = () => {
        const total = budgetData.reduce((acc, curr) => acc + curr.cost, 0);

        return (
          <SectionCard icon={Wallet} title="é ç®—æ¦‚ç®— (2äººåŒè¡Œï¼Œæ¯äººå¹³å‡)">
            <div className="overflow-x-auto">
              <table className="w-full text-left border-collapse">
                <thead>
                  <tr className="bg-primary text-white">
                    <th className="p-4 font-semibold rounded-tl-lg font-display tracking-wider">
                      é …ç›®
                    </th>
                    <th className="p-4 font-semibold">é‡‘é¡ (JPY)</th>
                    <th className="p-4 font-semibold rounded-tr-lg">èªªæ˜</th>
                  </tr>
                </thead>
                <tbody className="text-gray-600">
                  {budgetData.map((row, idx) => (
                    <tr
                      key={idx}
                      className="border-b border-gray-100 hover:bg-accent/5 transition-colors"
                    >
                      <td className="p-4 font-medium text-primary font-display">
                        {row.item}
                      </td>
                      <td className="p-4 font-mono text-dark">
                        Â¥{row.cost.toLocaleString()}
                      </td>
                      <td className="p-4 text-sm text-subtle">{row.note}</td>
                    </tr>
                  ))}
                  <tr className="bg-gradient-to-r from-primary to-[#0A1A30] text-accent font-bold border-t-2 border-accent">
                    <td className="p-4 rounded-bl-lg">ç¸½è¨ˆ</td>
                    <td className="p-4 font-mono text-xl text-white">
                      Â¥{total.toLocaleString()}
                    </td>
                    <td className="p-4 rounded-br-lg text-white/80 font-normal">
                      é ç®—é‡é»ï¼šåƒå¾—å¥½ã€ä½å¾—å¥½ã€ç§»å‹•èˆ’é©
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </SectionCard>
        );
      };

      // 3.6 MapModal (Fixed: Header icon now depends on data.type)
      const MapModal = ({ isOpen, onClose, data }) => {
        if (!isOpen || !data) return null;

        let mapUrl = "";
        let externalMapUrl = "";
        // Use cleaned name from DayCard, or raw query as fallback
        let title = data.name || data.query;

        if (data.type === "route") {
          mapUrl = `https://maps.google.com/maps?saddr=${encodeURIComponent(
            data.origin,
          )}&daddr=${encodeURIComponent(data.destination)}&dirflg=r&output=embed`;
          externalMapUrl = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(
            data.origin,
          )}&destination=${encodeURIComponent(data.destination)}&travelmode=transit`;
        } else {
          mapUrl = `https://maps.google.com/maps?q=${encodeURIComponent(
            data.query,
          )}&t=&z=15&ie=UTF8&iwloc=&output=embed`;
          externalMapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
            data.query,
          )}`;
        }

        return (
          <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
            <div className="bg-white w-full max-w-3xl h-[80vh] rounded-3xl shadow-2xl flex flex-col overflow-hidden relative anim-slideUp-h1">
              <div className="bg-primary p-4 flex items-center justify-between text-white shrink-0">
                <div className="flex items-center gap-2 flex-1 min-w-0">
                  {data.type === "route" ? (
                    <Train size={22} />
                  ) : (
                    <MapPin size={22} />
                  )}
                  <h3 className="font-bold text-lg truncate">{title}</h3>
                </div>
                <button
                  onClick={onClose}
                  className="ml-4 w-10 h-10 flex items-center justify-center bg-white/20 hover:bg-white/40 rounded-full transition-colors text-2xl font-bold flex-shrink-0"
                >
                  âœ•
                </button>
              </div>
              <div className="flex-1 bg-gray-100 relative">
                <iframe
                  width="100%"
                  height="100%"
                  frameBorder="0"
                  scrolling="no"
                  marginHeight="0"
                  marginWidth="0"
                  src={mapUrl}
                  title={title}
                  className="w-full h-full"
                ></iframe>
              </div>
              <div className="p-4 bg-white border-t border-gray-100 flex justify-between items-center shrink-0">
                <span className="text-xs text-gray-400">
                  * é è¦½åœ°åœ–å¯èƒ½å›  Google æ”¿ç­–å¶æœ‰è¼‰å…¥é™åˆ¶
                </span>
                <a
                  href={externalMapUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-2 px-4 py-2 bg-primary/5 text-primary rounded-lg hover:bg-indigo-100 font-medium transition-colors text-sm"
                >
                  åœ¨ Google Maps App é–‹å•Ÿ <ExternalLink size={14} />
                </a>
              </div>
            </div>
          </div>
        );
      };

      // 3.7 MapView
      const MapView = ({ onOpenMap }) => {
        return (
          <div className="space-y-8 animate-fade-in">
            <SectionCard icon={Navigation} title="è¡Œç¨‹å°èˆªè·¯ç·š">
              <div className="mb-6 bg-primary/5 border border-indigo-100 p-4 rounded-xl flex items-start gap-3">
                <Info className="text-primary shrink-0 mt-1" size={20} />
                <p className="text-indigo-800 text-sm leading-relaxed">
                  åœ°åœ–åŠŸèƒ½å·²å‡ç´šï¼š
                  <br />
                  <span className="font-bold">ğŸ“ å–®é»æœå°‹</span>
                  ï¼šé»æ“Šæ™¯é»åˆ—è¡¨ï¼ŒæŸ¥çœ‹å–®ä¸€ä½ç½®ã€‚
                  <br />
                  <span className="font-bold text-primary">
                    ğŸš— æ¯æ—¥ç§»å‹•è·¯å¾‘
                  </span>
                  ï¼šå·²åŒæ­¥æ•´åˆè‡³ã€Œæ¯æ—¥è©³æƒ…ã€åˆ†é ä¸­ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨ä¸‹æ–¹ç¸½è¦½é—œéµè·¯å¾‘ã€‚
                </p>
              </div>

              <div className="mb-8">
                <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                  <RouteIcon className="text-primary" size={20} />
                  æ¯æ—¥é—œéµäº¤é€šç§»å‹•è·¯å¾‘ç¸½è¦½
                </h3>
                <div className="grid md:grid-cols-2 gap-4">
                  {recommendedRoutes.map((route) => (
                    <button
                      key={route.id}
                      onClick={() =>
                        onOpenMap({
                          type: "route",
                          name: route.name,
                          origin: route.from,
                          destination: route.to,
                        })
                      }
                      className="bg-white border border-gray-200 p-4 rounded-xl shadow-sm hover:shadow-md hover:border-indigo-300 transition-all text-left flex items-start gap-3 group"
                    >
                      <div className="p-2 bg-primary/5 rounded-lg text-primary group-hover:bg-indigo-600 group-hover:text-white transition-colors shrink-0">
                        <div className="text-center">
                          <div className="text-[10px] font-bold uppercase leading-none mb-1">
                            {route.day.split(" ")[0]}
                          </div>
                          <div className="text-lg font-bold leading-none">
                            {route.day.split(" ")[1]}
                          </div>
                        </div>
                      </div>
                      <div>
                        <div className="font-bold text-gray-800 group-hover:text-indigo-700">
                          {route.name}
                        </div>
                        <div className="text-xs text-gray-500 mt-1">
                          {route.desc}
                        </div>
                        <div className="text-xs text-gray-400 mt-1 flex items-center gap-1">
                          {route.from.split(" ")[0]} <ArrowRight size={10} />{" "}
                          {route.to.split(" ")[0]}
                        </div>
                      </div>
                    </button>
                  ))}
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-8">
                {mapLocations.regions.map((region, idx) => (
                  <div
                    key={idx}
                    className="bg-white rounded-3xl shadow-md border border-gray-200 overflow-hidden flex flex-col"
                  >
                    <div className="p-6 bg-primary/5 border-b border-indigo-100">
                      <h3 className="text-lg font-bold text-gray-800 mb-2 flex items-center gap-2">
                        <MapPin className="text-primary" size={20} />
                        {region.name}
                      </h3>
                      <p className="text-sm text-gray-600 mb-4 h-10 line-clamp-2">
                        {region.description}
                      </p>
                      <a
                        href={region.routeLink}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="block w-full"
                      >
                        <div className="group bg-primary p-4 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all duration-300 flex items-center justify-between">
                          <div className="text-white">
                            <span className="text-xs font-bold opacity-80 uppercase tracking-wider">
                              Complete Route
                            </span>
                            <div className="font-bold flex items-center gap-2">
                              é–‹å•Ÿæœ¬éšæ®µå®Œæ•´è·¯ç·š{" "}
                              <ExternalLink size={14} className="opacity-80" />
                            </div>
                          </div>
                          <div className="bg-white/20 p-2 rounded-full group-hover:bg-white/30 transition-colors">
                            <Navigation className="text-white" size={18} />
                          </div>
                        </div>
                      </a>
                    </div>
                    <div className="p-4 flex-1 flex flex-col gap-2">
                      <div className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 px-2">
                        Key Locations
                      </div>
                      {region.spots.map((spot, sIdx) => {
                        const iconMap = {
                          transport: Train,
                          shopping: Wallet,
                          attraction: Star,
                          food: Utensils,
                          hotel: Hotel,
                        };
                        const SpotIcon = iconMap[spot.type] || MapPin;
                        return (
                          <button
                            key={sIdx}
                            onClick={() =>
                              onOpenMap({
                                type: "spot",
                                name: spot.name,
                                query: spot.query,
                              })
                            }
                            className="w-full flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group border border-transparent hover:border-gray-200 text-left"
                          >
                            <div className="flex items-center gap-3">
                              <div
                                className={`p-2 rounded-lg ${
                                  spot.type === "food"
                                    ? "bg-green-50 text-green-600"
                                    : "bg-gray-100 text-gray-500"
                                }`}
                              >
                                <SpotIcon size={16} />
                              </div>
                              <span className="text-gray-700 font-medium group-hover:text-primary transition-colors text-sm">
                                {spot.name}
                              </span>
                            </div>
                            <ExternalLink
                              size={14}
                              className="text-gray-300 group-hover:text-indigo-400"
                            />
                          </button>
                        );
                      })}
                    </div>
                  </div>
                ))}
              </div>
            </SectionCard>
          </div>
        );
      };

      // 3.8 AI & Translation Components
      const AIChatBubble = ({ sender, text }) => (
        <div
          className={`flex ${
            sender === "user" ? "justify-end" : "justify-start"
          } mb-4`}
        >
          <div
            className={`max-w-[80%] rounded-3xl p-4 text-sm leading-relaxed ${
              sender === "user"
                ? "bg-indigo-600 text-white rounded-br-none"
                : "bg-white border border-gray-100 text-gray-700 shadow-sm rounded-bl-none"
            }`}
          >
            {text}
          </div>
        </div>
      );

      const TranslatorButton = ({ label, prompt, onTranslate, isLoading }) => (
        <button
          onClick={() => onTranslate(prompt)}
          disabled={isLoading}
          className="w-full text-left p-3 rounded-xl border border-gray-200 hover:border-indigo-400 hover:bg-primary/5 transition-all duration-200 group flex items-center justify-between"
        >
          <span className="font-medium text-gray-700 group-hover:text-indigo-700">
            {label}
          </span>
          <Sparkles
            size={16}
            className="text-gray-300 group-hover:text-indigo-500"
          />
        </button>
      );

      const AIModal = ({ isOpen, onClose }) => {
        const [activeFeature, setActiveFeature] = useState("chat");
        const [chatHistory, setChatHistory] = useState([
          {
            sender: "ai",
            text: "å—¨ï¼æˆ‘æ˜¯æ‚¨çš„ç´ é£Ÿæ—…éŠ AI åŠ©æ‰‹ã€‚é—œæ–¼è¡Œç¨‹ã€ç´ é£Ÿé¤å»³æˆ–æ—¥æœ¬æ—…éŠçš„å•é¡Œéƒ½å¯ä»¥å•æˆ‘å–”ï¼âœ¨",
          },
        ]);
        const [inputText, setInputText] = useState("");
        const [isLoading, setIsLoading] = useState(false);
        const [translationResult, setTranslationResult] = useState(null);
        const chatEndRef = useRef(null);

        useEffect(() => {
          if (chatEndRef.current) {
            chatEndRef.current.scrollIntoView({ behavior: "smooth" });
          }
        }, [chatHistory, activeFeature]);

        if (!isOpen) return null;

        const handleSendMessage = async () => {
          if (!inputText.trim()) return;

          const userMsg = inputText;
          setChatHistory((prev) => [
            ...prev,
            { sender: "user", text: userMsg },
          ]);
          setInputText("");
          setIsLoading(true);

          const response = await callGeminiAPI(userMsg);

          setChatHistory((prev) => [...prev, { sender: "ai", text: response }]);
          setIsLoading(false);
        };

        const handleTranslate = async (restriction) => {
          setIsLoading(true);
          setTranslationResult(null);
          const prompt = `
                    Please translate the following dietary restriction into natural, polite Japanese for a restaurant staff member.
                    Constraint: "${restriction}"
                    
                    Format the output exactly as:
                    Japanese: [Japanese text]
                    Pronunciation: [Romaji]
                    Meaning: [Brief explanation in Traditional Chinese]
                `;
          const response = await callGeminiAPI(
            prompt,
            "You are a translator. Keep formatting simple and clean.",
          );
          setTranslationResult(response);
          setIsLoading(false);
        };

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-fade-in">
            <div className="bg-gray-50 w-full max-w-lg h-[600px] rounded-3xl shadow-2xl flex flex-col overflow-hidden relative anim-slideUp-h1">
              <div className="bg-primary p-4 flex items-center justify-between text-white shrink-0">
                <div className="flex items-center gap-2">
                  <Bot size={24} className="text-indigo-200" />
                  <h3 className="font-bold text-lg">AI æ—…éŠåŠ©æ‰‹</h3>
                </div>
                <button
                  onClick={onClose}
                  className="p-1 hover:bg-white/20 rounded-full transition-colors"
                >
                  <X size={20} />
                </button>
              </div>

              <div className="flex p-2 bg-white border-b border-gray-100 gap-2 shrink-0">
                <button
                  onClick={() => setActiveFeature("chat")}
                  className={`flex-1 py-2 flex items-center justify-center gap-2 rounded-lg text-sm font-semibold transition-colors ${
                    activeFeature === "chat"
                      ? "bg-indigo-100 text-indigo-700"
                      : "text-gray-500 hover:bg-gray-100"
                  }`}
                >
                  <MessageCircle size={16} /> è¡Œç¨‹é¡§å•
                </button>
                <button
                  onClick={() => setActiveFeature("translate")}
                  className={`flex-1 py-2 flex items-center justify-center gap-2 rounded-lg text-sm font-semibold transition-colors ${
                    activeFeature === "translate"
                      ? "bg-indigo-100 text-indigo-700"
                      : "text-gray-500 hover:bg-gray-100"
                  }`}
                >
                  <Languages size={16} /> ç´ é£Ÿæºé€šå¡
                </button>
              </div>

              <div className="flex-1 overflow-y-auto p-4 bg-gray-50">
                {activeFeature === "chat" && (
                  <div className="flex flex-col min-h-full justify-end">
                    <div className="flex-1 pb-4">
                      {chatHistory.map((msg, idx) => (
                        <AIChatBubble
                          key={idx}
                          sender={msg.sender}
                          text={msg.text}
                        />
                      ))}
                      {isLoading && (
                        <div className="flex justify-start mb-4">
                          <div className="bg-white border border-gray-100 rounded-3xl p-4 text-gray-400 text-sm shadow-sm flex items-center gap-2">
                            <Sparkles
                              size={14}
                              className="animate-spin text-indigo-500"
                            />{" "}
                            AI æ€è€ƒä¸­...
                          </div>
                        </div>
                      )}
                      <div ref={chatEndRef} />
                    </div>
                  </div>
                )}

                {activeFeature === "translate" && (
                  <div className="space-y-4">
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-indigo-100">
                      <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2">
                        <Leaf size={16} className="text-green-500" />{" "}
                        é¸æ“‡æ‚¨çš„é£²é£Ÿéœ€æ±‚
                      </h4>
                      <div className="grid grid-cols-1 gap-2">
                        <TranslatorButton
                          label="ğŸš« æˆ‘ä¸åƒè‚‰å’Œé­š (Meat/Fish Free)"
                          prompt="I do not eat meat or fish."
                          onTranslate={handleTranslate}
                          isLoading={isLoading}
                        />
                        <TranslatorButton
                          label="ğŸŸ æˆ‘ä¸èƒ½åƒæŸ´é­šé«˜æ¹¯ (No Dashi)"
                          prompt="I cannot eat dashi (fish stock). Please verify if the soup or sauce contains fish stock."
                          onTranslate={handleTranslate}
                          isLoading={isLoading}
                        />
                        <TranslatorButton
                          label="ğŸ§… æˆ‘ä¸åƒäº”è¾› (No Alliums)"
                          prompt="I do not eat onions, garlic, chives, leeks, or scallions. (Oriental Vegetarian)"
                          onTranslate={handleTranslate}
                          isLoading={isLoading}
                        />
                        <TranslatorButton
                          label="ğŸ¥šğŸ¥› æˆ‘ä¸åƒè›‹å¥¶ (Vegan)"
                          prompt="I am Vegan. I do not eat meat, fish, eggs, milk, or honey."
                          onTranslate={handleTranslate}
                          isLoading={isLoading}
                        />
                      </div>
                    </div>
                    {isLoading && !translationResult && (
                      <div className="text-center py-8 text-indigo-400 flex flex-col items-center gap-2">
                        <Sparkles className="animate-spin" />
                        <span className="text-sm">
                          Gemini-3.0-Pro æ­£åœ¨ç‚ºæ‚¨æ’°å¯«æ—¥æ–‡...
                        </span>
                      </div>
                    )}
                    {translationResult && (
                      <div className="bg-white border-2 border-indigo-500 rounded-xl p-5 shadow-md anim-slideUp-p">
                        <div className="flex items-center justify-between mb-3 border-b border-gray-100 pb-2">
                          <span className="text-xs font-bold text-indigo-500 uppercase tracking-wider">
                            Show to Staff
                          </span>
                          <Sparkles size={14} className="text-yellow-500" />
                        </div>
                        <div className="whitespace-pre-wrap text-gray-800 leading-relaxed font-medium">
                          {translationResult}
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </div>

              {activeFeature === "chat" && (
                <div className="p-4 bg-white border-t border-gray-100 shrink-0">
                  <div className="flex items-center gap-2">
                    <input
                      type="text"
                      value={inputText}
                      onChange={(e) => setInputText(e.target.value)}
                      onKeyDown={(e) =>
                        e.key === "Enter" && handleSendMessage()
                      }
                      placeholder="è¼¸å…¥å•é¡Œï¼Œä¾‹å¦‚ï¼šé™„è¿‘æœ‰æ¨è–¦çš„é»å¿ƒå—ï¼Ÿ"
                      className="flex-1 px-4 py-2.5 bg-gray-100 border-none rounded-full focus:ring-2 focus:ring-indigo-500 outline-none transition-all"
                    />
                    <button
                      onClick={handleSendMessage}
                      disabled={isLoading}
                      className="p-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 disabled:opacity-50 transition-colors shadow-md"
                    >
                      <Send size={18} />
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };

      // --- 4. ä¸»ç¨‹å¼ (Main Application) ---

      const App = () => {
        const [activeTab, setActiveTab] = useState("itinerary");
        const [isAIModalOpen, setIsAIModalOpen] = useState(false);
        const [mapModalData, setMapModalData] = useState({
          isOpen: false,
          data: null,
        });

        const tabs = [
          { id: "overview", label: "è¡Œç¨‹ç¸½è¦½", icon: MapIcon },
          { id: "itinerary", label: "æ¯æ—¥è©³æƒ…", icon: Calendar },
          { id: "budget", label: "é ç®—è¦åŠƒ", icon: Wallet },
          { id: "map", label: "è¡Œç¨‹åœ°åœ–", icon: Navigation },
        ];

        const handleOpenMap = (data) => {
          setMapModalData({ isOpen: true, data });
        };

        return (
          <div className="min-h-screen bg-gray-50 font-sans selection:bg-indigo-200 selection:text-indigo-900 pb-24 md:pb-12">
            <Header />

            <div className="sticky top-0 z-40 glass shadow-sm border-b border-gray-100/50">
              <div className="max-w-5xl mx-auto px-4">
                <nav className="flex items-center justify-around gap-1 sm:gap-2 md:gap-8 py-3 md:py-4">
                  {tabs.map((tab) => {
                    const isActive = activeTab === tab.id;
                    const TabIcon = tab.icon;
                    return (
                      <button
                        key={tab.id}
                        onClick={() => setActiveTab(tab.id)}
                        className={`
                                                flex items-center justify-center gap-1 sm:gap-2 px-3 py-2 sm:px-4 sm:py-2.5 md:px-5 rounded-full font-medium transition-all duration-300 whitespace-nowrap text-xs sm:text-sm md:text-base
                                                ${
                                                  isActive
                                                    ? "bg-primary text-white shadow-md transform scale-105"
                                                    : "bg-transparent text-gray-500 hover:bg-gray-100 hover:text-gray-700"
                                                }
                                            `}
                      >
                        <TabIcon size={18} className="flex-shrink-0" />
                        <span className="hidden sm:inline">{tab.label}</span>
                      </button>
                    );
                  })}
                </nav>
              </div>
            </div>

            <main className="max-w-5xl mx-auto px-6 py-8">
              {activeTab === "overview" && (
                <div className="animate-fade-in space-y-8">
                  <StrategySection />

                  <div className="grid md:grid-cols-2 gap-8">
                    {itineraryData.map((phase, idx) => (
                      <div
                        key={idx}
                        className="bg-white rounded-3xl p-6 shadow-md border-t-4 border-indigo-500"
                      >
                        <h3 className="text-xl font-bold text-gray-800 mb-4 pb-2 border-b border-gray-100">
                          {phase.phase}
                        </h3>
                        <div className="space-y-4">
                          {phase.days.map((day, dIdx) => (
                            <div key={dIdx} className="flex items-start gap-3">
                              <div className="min-w-[3rem] text-sm font-bold text-indigo-500 bg-primary/5 px-2 py-1 rounded text-center">
                                D{day.day}
                              </div>
                              <div className="text-gray-700 text-sm font-medium pt-1">
                                {day.title}
                              </div>
                            </div>
                          ))}
                        </div>
                        <button
                          onClick={() => setActiveTab("itinerary")}
                          className="mt-6 w-full py-2 flex items-center justify-center gap-2 text-primary font-semibold text-sm hover:bg-primary/5 rounded-lg transition-colors"
                        >
                          æŸ¥çœ‹è©³æƒ… <ArrowRight size={16} />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {activeTab === "itinerary" && (
                <div className="space-y-12">
                  {itineraryData.map((phase, idx) => (
                    <div key={idx} className="relative">
                      <div className="sticky top-20 z-30 bg-gray-50/95 backdrop-blur py-4 mb-4">
                        <h2 className="text-2xl font-bold text-gray-800 pl-4 border-l-4 border-purple-500">
                          {phase.phase}
                        </h2>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {phase.days.map((day, dIdx) => (
                          <DayCard
                            key={dIdx}
                            dayData={day}
                            onOpenRoute={handleOpenMap}
                          />
                        ))}
                      </div>
                    </div>
                  ))}

                  <div className="flex justify-center mt-12">
                    <button
                      onClick={() =>
                        window.scrollTo({ top: 0, behavior: "smooth" })
                      }
                      className="px-5 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors"
                    >
                      å›åˆ°é ‚éƒ¨
                    </button>
                  </div>
                </div>
              )}

              {activeTab === "budget" && (
                <div className="max-w-3xl mx-auto">
                  <BudgetTable />
                  <div className="mt-8 p-6 bg-primary/5 rounded-3xl flex gap-4 items-start">
                    <Info className="text-primary flex-shrink-0 mt-1" />
                    <div className="text-sm text-indigo-800 leading-relaxed">
                      <p className="font-bold mb-1">é—œæ–¼åŒ¯ç‡èˆ‡é è¨‚</p>
                      å»ºè­°æå‰ 3-6 å€‹æœˆé–‹å§‹é è¨‚ä½å®¿ä»¥ç¢ºä¿æ—©é³¥å„ªæƒ ã€‚Shimakaze
                      è§€å…‰ç‰¹æ€¥éœ€åœ¨ä¹˜è»Šæ—¥å‰ä¸€å€‹æœˆä¸Šåˆ 10:30 æº–æ™‚æ¶ç¥¨ã€‚
                    </div>
                  </div>
                </div>
              )}

              {activeTab === "map" && <MapView onOpenMap={handleOpenMap} />}
            </main>

            <button
              onClick={() => setIsAIModalOpen(true)}
              className="fixed bottom-6 right-6 z-50 p-4 rounded-full bg-primary text-white shadow-2xl hover:scale-110 hover:shadow-indigo-500/50 transition-all duration-300 group"
            >
              <Sparkles size={28} className="animate-pulse" />
              <span className="absolute right-full mr-3 top-1/2 -translate-y-1/2 bg-gray-900 text-white text-xs font-bold py-1 px-3 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
                âœ¨ AI æ—…éŠé¡§å•
              </span>
            </button>

            <AIModal
              isOpen={isAIModalOpen}
              onClose={() => setIsAIModalOpen(false)}
            />
            <MapModal
              isOpen={mapModalData.isOpen}
              onClose={() =>
                setMapModalData({ ...mapModalData, isOpen: false })
              }
              data={mapModalData.data}
            />

            <footer className="text-center py-8 text-gray-400 text-sm">
              <p>Â© 2026 ä¼Šå‹¢å¿—æ‘©â€§å¤§é˜ªç´ é£Ÿè±ªè¯æ…¢æ—… v5 (NGO é€²å‡ºç‰ˆ)</p>
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
